# Домашнее задание №1 (base) ML_AI_24
### Выполнила: Теплова Людмила (@lteplova)

Репозиторий содержит две части работы: 
* изучение данных, обучение моделей, оценка, выбор модели
* разработка FastAPI сервиса для демонстрации работы модели

Данные: 
- имеем два csv файла с тренировочными (cars_train.csv) и тестовыми данными (cars_test.csv)
- тренировочная выборка - 6999 строк, 13 колонок (категориальные и вещественные)
- тестовая выборка - 1000 строк, 13 колонок (категориальные и вещественные)
- целевая переменная - **selling_price**
- в данных есть дубликаты и пропуски

#### Часть 1.
Результат находится в `/ml_ipynb/[Regression_with_inference_base_teplova.ipynb]`
в файле `/ml_ipynb/cars_report.html`  находится EDA дашборд построенный с помощью  `ydata-profilling`

Этапы проведения работы:
1. Были найдены дубликаты - как полные, так и частичные, удаление дубликатов согласно заданию
2. Предобработка колонок с текстовми данными, которые должны быть вещественными (с помощью регулярных выражений были выдены нужные характеристики), исправление ошибок в данных
3. Заполнение пропусков медианным значением
4. Построены визуализации, для изучения зависимостей между признаками и от целевой переменной, есть зависимости между признаками:
   * 'year' и 'selling price' (обратная зависимость)
   * 'max_power' и 'selling price'
   * 'engine' и 'selling price'
   * 'torque' и 'selling price'
   * 'selling price' и 'km driven'
   * 'max_power' и 'torque'
   * 'max_power' и 'engine'
   * 'torque' и 'engine'
5. Построены ящики с усами для анализа выбросов (выбросы не были удалены, за исключением пары найденных ошибок после предобработки данных).
6. Обучение ряда моделей:
   1. LinearRegression (результат - test_R2: 0.6008959074615126)
   2. LinearRegression + Scaling (результат - **test_R2**: 0.6008959074615139) нормализация не помогла улучшить результат
   3. Lasso (результат **test_R2**: 0.6008946507062642)
   4. Далее был выполнен GridSearchCV для Lasso (best_params_: {'alpha': 1000} (результат test_R2: 0.5996379161788171)
   5. ElasticNet (best_params_ - ElasticNet(alpha=0.5, max_iter=1500, tol=0.01), результат **test_R2**: 0.5815871186161323.
   6. Добавили категориальные признаки.
   7. Предобработан признак name (оставила только название вендора)
   8. Кодирование с помощью OneHotEncoder
   9. Сохранение ohe модели в pikle для дальнейшего использование в сервисе FastAPI
   10. После кодирования получилось всего 47 признаков
   11. Обучена Ridge модель на всех полученных признаках, результат (**test_R2**: 0.781338970327392)
   12. проведен GridSearchCV для данной модели best_params_ -  {'alpha': 1}, результат  (**test_R2**: 0.7627981379878783)
   13. Сохранение модели в pikle для дальнейшего использование в сервисе FastAPI
**Вывод**: наибольшее улучшение касетва предсказания получено в результате добавления категориальных признаков.  Не получилось повысить точность, нужно провести разработку и добавление новых признаков, выброс незначимых признаков. Не получлось углубиться в работу с признаками.


#### Часть 2.
#### FasAPI Service 

сервис состоит из следующих файлов:
- `model.py` - код инференса модели
- `prep_punc.py` - код предобработки данных перед подачей в модель
- `app.py` - код сервиса
- `public/index.html` - фронтовая часть сервиса для передачи данных
- `models/ridge.pkl` - обученная Ridge модель, которая используется в инференсе
- `models/ohe.pkl` - обученная OneHotEncoder, используется в `prep_punc.py`

стек: `FastAPI`, `FileResponse`, `pydantic`, `pandas`, `json`, `StringIO`, `pickle`, `re`, `dataclasses`, `numpy`, `sklearn`, `matplotlib`, `seaborn`

Демонстрация работы сервиса:

1. Загрузка index.html
<img width="863" alt="01" src="https://github.com/user-attachments/assets/9fc18d4c-31f7-4884-9131-cef95e729d0e">

2. Ввод текста в текстовое поле, нажатие “Предсказать”,  получение результата “Цена квартиры”
<img width="984" alt="02" src="https://github.com/user-attachments/assets/c75aea63-72b3-46f5-8d17-9261e8b40701">

3. Загрузка файла cars.csv.
формат файла следующий:
<img width="1202" alt="05" src="https://github.com/user-attachments/assets/7432d838-6c5d-401f-a2bb-b83427370564">

Нажатие “Предсказать”, затем “Скачать csv c результатом”
<img width="946" alt="03" src="https://github.com/user-attachments/assets/37a8e302-6c7c-41c9-b410-9e5ae2eeea9a">

В результируещем файле file.csv появилась колонка prediction, которая содержит результат предстказания с помощью модели:
<img width="1346" alt="04" src="https://github.com/user-attachments/assets/36cde7c3-88f9-4ce7-8101-b823409b2cfb">

Скринкаст с демонстрацией:

[scrcast.mov](https://disk.yandex.ru/i/COQoCoXx7z3Y2Q)
